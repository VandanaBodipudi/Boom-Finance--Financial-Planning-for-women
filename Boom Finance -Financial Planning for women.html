<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bloom Finance - Financial Planning for Women</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'bloom-pink': '#ff85a2',
                        'bloom-purple': '#9c89b8',
                        'bloom-lavender': '#e2d1f9',
                        'bloom-mint': '#a0e7e5',
                        'bloom-coral': '#ff6b6b',
                    }
                }
            }
        }
    </script>
    <style>
        .page {
            display: none;
            min-height: 100vh;
        }
        .active-page {
            display: block;
        }
        .chart-container {
            position: relative;
            height: 300px;
        }
        .transaction-item:hover {
            background-color: #fdf2f8;
            transform: translateY(-2px);
            transition: all 0.3s ease;
        }
        .gradient-bg {
            background: linear-gradient(135deg, #ff85a2 0%, #9c89b8 100%);
        }
        .sidebar {
            transition: all 0.3s ease;
            background: linear-gradient(180deg, #9c89b8 0%, #ff85a2 100%);
        }
        .nav-item {
            display: flex;
            align-items: center;
            padding: 12px 16px;
            border-radius: 12px;
            margin-bottom: 8px;
            transition: all 0.3s ease;
        }
        .nav-item:hover {
            background-color: rgba(255, 255, 255, 0.2);
        }
        .nav-item.active {
            background-color: rgba(255, 255, 255, 0.3);
        }
        .nav-item i {
            margin-right: 12px;
            width: 20px;
        }
        @media (max-width: 768px) {
            .sidebar {
                transform: translateX(-100%);
            }
            .sidebar.mobile-open {
                transform: translateX(0);
            }
        }
        .goal-card {
            background: linear-gradient(135deg, #e2d1f9 0%, #a0e7e5 100%);
            border-radius: 16px;
            padding: 20px;
            margin-bottom: 16px;
        }
        .progress-bar {
            background-color: rgba(255, 255, 255, 0.3);
            border-radius: 10px;
            overflow: hidden;
            height: 8px;
        }
        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #ff6b6b 0%, #ff85a2 100%);
            border-radius: 10px;
            transition: width 0.3s ease;
        }
    </style>
</head>
<body class="bg-bloom-lavender font-sans">
    <!-- Loading Screen -->
    <div id="loading" class="fixed inset-0 bg-white flex items-center justify-center z-50">
        <div class="text-center">
            <div class="w-16 h-16 border-4 border-bloom-pink border-t-transparent rounded-full animate-spin mx-auto"></div>
            <p class="mt-4 text-gray-600">Loading Bloom Finance...</p>
        </div>
    </div>

    <!-- Login Page -->
    <div id="login-page" class="page">
        <div class="min-h-screen flex">
            <div class="flex-1 flex flex-col justify-center py-12 px-4 sm:px-6 lg:flex-none lg:px-20 xl:px-24">
                <div class="mx-auto w-full max-w-sm lg:w-96">
                    <div class="text-center">
                        <img class="h-16 w-auto mx-auto" src="https://storage.googleapis.com/workspace-0f70711f-8b4e-4d94-86f1-2a93ccde5887/image/1a35c51e-0763-4d25-8c0c-f864e43071ba.png" alt="Bloom Finance Logo" 
                             onerror="this.src='https://storage.googleapis.com/workspace-0f70711f-8b4e-4d94-86f1-2a93ccde5887/image/d7f47830-ef58-4c84-a275-74ecb19dce66.png'">
                        <h2 class="mt-6 text-3xl font-extrabold text-gray-900">
                            Welcome to Bloom Finance
                        </h2>
                        <p class="mt-2 text-sm text-gray-600">
                            Empowering women to take control of their financial future
                        </p>
                        <p class="mt-6 text-sm text-gray-600">
                            Don't have an account? <a href="#" class="font-medium text-bloom-pink hover:text-bloom-purple" onclick="showRegister()">
                                Start your journey
                            </a>
                        </p>
                    </div>

                    <div class="mt-8">
                        <div class="mt-6">
                            <form class="space-y-6" onsubmit="handleLogin(event)">
                                <div>
                                    <label for="email" class="block text-sm font-medium text-gray-700">
                                        Email address
                                    </label>
                                    <div class="mt-1">
                                        <input id="email" name="email" type="email" autocomplete="email" required 
                                               class="appearance-none block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm placeholder-gray-400 focus:outline-none focus:ring-bloom-pink focus:border-bloom-pink sm:text-sm">
                                    </div>
                                </div>

                                <div class="space-y-1">
                                    <label for="password" class="block text-sm font-medium text-gray-700">
                                        Password
                                    </label>
                                    <div class="mt-1">
                                        <input id="password" name="password" type="password" autocomplete="current-password" required 
                                               class="appearance-none block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm placeholder-gray-400 focus:outline-none focus:ring-bloom-pink focus:border-bloom-pink sm:text-sm">
                                    </div>
                                </div>

                                <div class="flex items-center justify-between">
                                    <div class="flex items-center">
                                        <input id="remember-me" name="remember-me" type="checkbox" 
                                               class="h-4 w-4 text-bloom-pink focus:ring-bloom-pink border-gray-300 rounded">
                                        <label for="remember-me" class="ml-2 block text-sm text-gray-900">
                                            Remember me
                                        </label>
                                    </div>

                                    <div class="text-sm">
                                        <a href="#" class="font-medium text-bloom-pink hover:text-bloom-purple">
                                            Forgot your password?
                                        </a>
                                    </div>
                                </div>

                                <div>
                                    <button type="submit" 
                                            class="w-full flex justify-center py-2 px-4 border border-transparent rounded-md shadow-sm text-sm font-medium text-white gradient-bg hover:opacity-90 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-bloom-pink">
                                        Sign in
                                    </button>
                                </div>
                            </form>
                        </div>
                    </div>
                </div>
            </div>
            <div class="hidden lg:block relative w-0 flex-1">
                <img class="absolute inset-0 h-full w-full object-cover" 
                     src="https://storage.googleapis.com/workspace-0f70711f-8b4e-4d94-86f1-2a93ccde5887/image/d5978fc5-0ac1-4bae-bedf-a4ae553aa366.png" 
                     alt="Group of diverse young women discussing finances and planning together in a modern cafe setting"
                     onerror="this.style.backgroundColor='#ff85a2'">
            </div>
        </div>
    </div>

    <!-- Register Page -->
    <div id="register-page" class="page">
        <div class="min-h-screen flex items-center justify-center py-12 px-4 sm:px-6 lg:px-8 bg-bloom-lavender">
            <div class="max-w-md w-full space-y-8">
                <div class="text-center">
                    <img class="mx-auto h-16 w-auto" src="https://storage.googleapis.com/workspace-0f70711f-8b4e-4d94-86f1-2a93ccde5887/image/9dde8c7d-4b63-4d0e-8dcc-9ec3db5ab10b.png" alt="Bloom Finance Logo"
                         onerror="this.src='https://placehold.co/200x80/ff85a2/ffffff?text=Bloom+Finance'">
                    <h2 class="mt-6 text-center text-3xl font-extrabold text-gray-900">
                        Join Our Community
                    </h2>
                    <p class="mt-2 text-center text-sm text-gray-600">
                        Start your journey to financial independence today
                    </p>
                    <p class="mt-2 text-center text-sm text-gray-600">
                        Already a member? <a href="#" class="font-medium text-bloom-pink hover:text-bloom-purple" onclick="showLogin()">
                            Sign in here
                        </a>
                    </p>
                </div>
                <form class="mt-8 space-y-6" onsubmit="handleRegister(event)">
                    <div class="rounded-md shadow-sm -space-y-px">
                        <div>
                            <input id="register-name" name="name" type="text" required 
                                   class="appearance-none rounded-none relative block w-full px-3 py-2 border border-gray-300 placeholder-gray-500 text-gray-900 rounded-t-md focus:outline-none focus:ring-bloom-pink focus:border-bloom-pink focus:z-10 sm:text-sm"
                                   placeholder="Full Name">
                        </div>
                        <div>
                            <input id="register-email" name="email" type="email" required 
                                   class="appearance-none rounded-none relative block w-full px-3 py-2 border border-gray-300 placeholder-gray-500 text-gray-900 focus:outline-none focus:ring-bloom-pink focus:border-bloom-pink focus:z-10 sm:text-sm"
                                   placeholder="Email address">
                        </div>
                        <div>
                            <input id="register-password" name="password" type="password" required 
                                   class="appearance-none rounded-none relative block w-full px-3 py-2 border border-gray-300 placeholder-gray-500 text-gray-900 focus:outline-none focus:ring-bloom-pink focus:border-bloom-pink focus:z-10 sm:text-sm"
                                   placeholder="Password (min. 8 characters)">
                        </div>
                        <div>
                            <input id="register-confirm" name="confirm-password" type="password" required 
                                   class="appearance-none rounded-none relative block w-full px-3 py-2 border border-gray-300 placeholder-gray-500 text-gray-900 rounded-b-md focus:outline-none focus:ring-bloom-pink focus:border-bloom-pink focus:z-10 sm:text-sm"
                                   placeholder="Confirm Password">
                        </div>
                    </div>

                    <div class="flex items-center">
                        <input id="terms" name="terms" type="checkbox" required
                               class="h-4 w-4 text-bloom-pink focus:ring-bloom-pink border-gray-300 rounded">
                        <label for="terms" class="ml-2 block text-sm text-gray-900">
                            I agree to the <a href="#" class="text-bloom-pink hover:text-bloom-purple">Terms</a> and want to receive financial tips
                        </label>
                    </div>

                    <div>
                        <button type="submit" 
                                class="group relative w-full flex justify-center py-2 px-4 border border-transparent rounded-md shadow-sm text-sm font-medium text-white gradient-bg hover:opacity-90 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-bloom-pink">
                            Start Blooming
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Main App Layout -->
    <div id="app-page" class="page">
        <!-- Header -->
        <header class="bg-white shadow-sm">
            <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
                <div class="flex justify-between h-16 items-center">
                    <div class="flex items-center">
                        <button class="md:hidden mr-2" onclick="toggleSidebar()">
                            <i class="fas fa-bars text-gray-600"></i>
                        </button>
                        <img class="h-8 w-auto" src="https://storage.googleapis.com/workspace-0f70711f-8b4e-4d94-86f1-2a93ccde5887/image/0e960a70-1b8a-4ed6-987e-0bd68b52909f.png" alt="Bloom Finance Logo"
                             onerror="this.src='https://storage.googleapis.com/workspace-0f70711f-8b4e-4d94-86f1-2a93ccde5887/image/fd686032-42a2-40eb-8134-eb3659806c15.png'">
                    </div>
                    
                    <div class="flex items-center space-x-4">
                        <div class="relative">
                            <button class="p-2 text-gray-600 hover:text-bloom-pink">
                                <i class="fas fa-bell"></i>
                                <span class="absolute top-0 right-0 h-2 w-2 bg-bloom-coral rounded-full"></span>
                            </button>
                        </div>
                        <div class="relative">
                            <button id="header-user-btn" type="button" class="flex items-center space-x-2" aria-haspopup="true" aria-expanded="false">
                                <div class="w-8 h-8 gradient-bg rounded-full flex items-center justify-center">
                                    <span class="text-white text-sm font-medium" id="user-initials">U</span>
                                </div>
                            </button>
                            <div id="user-menu" class="hidden absolute right-0 mt-2 w-48 bg-white rounded-md shadow-lg py-1 z-50" role="menu" aria-labelledby="header-user-btn">
                                <div class="px-4 py-2 border-b">
                                    <div class="font-semibold" id="menu-user-name">User</div>
                                    <div class="text-xs text-gray-500" id="menu-user-email"></div>
                                </div>
                                <a href="#" class="block px-4 py-2 text-sm text-gray-700 hover:bg-pink-50" onclick="navigateTo('profile'); closeUserMenu(); return false;">My Profile</a>
                                <a href="#" class="block px-4 py-2 text-sm text-gray-700 hover:bg-pink-50" onclick="navigateTo('settings'); closeUserMenu(); return false;">Settings</a>
                                <a href="#" class="block px-4 py-2 text-sm text-gray-700 hover:bg-pink-50" onclick="handleLogout(); closeUserMenu(); return false;">Sign out</a>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </header>

        <div class="flex">
            <!-- Sidebar -->
            <div id="sidebar" class="sidebar text-white w-64 min-h-screen fixed md:relative top-0 left-0 z-40">
                <div class="p-4">
                    <div class="text-center mb-8">
                        <div class="text-center mb-8 relative">
                            <button id="sidebar-user-btn" class="w-16 h-16 bg-white rounded-full mx-auto mb-2 flex items-center justify-center focus:outline-none" aria-haspopup="true" aria-expanded="false">
                                <i class="fas fa-seedling text-bloom-pink text-2xl"></i>
                            </button>
                            <div id="sidebar-user-menu" class="hidden absolute left-1/2 transform -translate-x-1/2 mt-2 w-56 bg-white text-gray-800 rounded-md shadow-lg z-50">
                                <div class="px-4 py-3 border-b">
                                    <div class="font-semibold" id="sidebar-user-name">User</div>
                                    <div class="text-xs text-gray-500" id="sidebar-user-email">user@example.com</div>
                                </div>
                                <a href="#" class="block px-4 py-2 text-sm hover:bg-bloom-lavender" onclick="navigateTo('profile'); closeSidebarUserMenu();">My Profile</a>
                                <a href="#" class="block px-4 py-2 text-sm hover:bg-bloom-lavender" onclick="navigateTo('settings'); closeSidebarUserMenu();">Settings</a>
                                <a href="#" class="block px-4 py-2 text-sm hover:bg-bloom-lavender" onclick="handleLogout(); closeSidebarUserMenu();">Sign out</a>
                            </div>
                            <p class="text-sm opacity-80">Welcome back,</p>
                            <p class="font-semibold" id="user-name">User</p>
                        </div>
                        
                    </div>
                    
                    <nav class="mt-8">
                        <div class="px-4 space-y-1">
                            <a href="#" class="nav-item active" onclick="navigateTo('dashboard')">
                                <i class="fas fa-home"></i>
                                <span>Dashboard</span>
                            </a>
                            <a href="#" class="nav-item" onclick="navigateTo('budget')">
                                <i class="fas fa-wallet"></i>
                                <span>My Budget</span>
                            </a>
                            <a href="#" class="nav-item" onclick="navigateTo('goals')">
                                <i class="fas fa-bullseye"></i>
                                <span>Savings Goals</span>
                            </a>
                            <a href="#" class="nav-item" onclick="navigateTo('transactions')">
                                <i class="fas fa-exchange-alt"></i>
                                <span>Transactions</span>
                            </a>
                            <a href="#" class="nav-item" onclick="navigateTo('education')">
                                <i class="fas fa-graduation-cap"></i>
                                <span>Learn & Grow</span>
                            </a>
                            <a href="#" class="nav-item" onclick="navigateTo('community')">
                                <i class="fas fa-users"></i>
                                <span>Community</span>
                            </a>
                        </div>
                    </nav>
                </div>
            </div>

            <!-- Main Content -->
            <main class="flex-1 p-6">
                <!-- Dashboard Page -->
                <div id="dashboard-page" class="page-content">
                    <div class="mb-8">
                        <h1 class="text-2xl font-bold text-gray-900">Financial Dashboard</h1>
                        <p class="text-gray-600">Hello beautiful! Here's your financial wellness snapshot.</p>
                    </div>

                    <!-- Financial Summary Cards -->
                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
                        <div class="bg-white rounded-lg shadow p-6">
                            <div class="flex items-center">
                                <div class="p-3 bg-pink-100 rounded-lg">
                                    <i class="fas fa-piggy-bank text-bloom-pink"></i>
                                </div>
                                <div class="ml-4">
                                    <p class="text-sm text-gray-600">Total Savings</p>
                                    <p id="card-total-savings" class="text-2xl font-bold text-bloom-purple">â‚¹0.00</p>
                                </div>
                            </div>
                        </div>
                        
                        <div class="bg-white rounded-lg shadow p-6">
                            <div class="flex items-center">
                                <div class="p-3 bg-green-100 rounded-lg">
                                    <i class="fas fa-arrow-up text-green-600"></i>
                                </div>
                                <div class="ml-4">
                                    <p class="text-sm text-gray-600">Monthly Income</p>
                                    <p id="card-monthly-income" class="text-2xl font-bold text-green-600">â‚¹0.00</p>
                                </div>
                            </div>
                        </div>
                        
                        <div class="bg-white rounded-lg shadow p-6">
                            <div class="flex items-center">
                                <div class="p-3 bg-red-100 rounded-lg">
                                    <i class="fas fa-arrow-down text-red-600"></i>
                                </div>
                                <div class="ml-4">
                                    <p class="text-sm text-gray-600">Monthly Expenses</p>
                                    <p id="card-monthly-expense" class="text-2xl font-bold text-red-600">â‚¹0.00</p>
                                </div>
                            </div>
                        </div>
                        
                        <div class="bg-white rounded-lg shadow p-6">
                            <div class="flex items-center">
                                <div class="p-3 bg-purple-100 rounded-lg">
                                    <i class="fas fa-chart-line text-bloom-purple"></i>
                                </div>
                                <div class="ml-4">
                                    <p class="text-sm text-gray-600">Savings Rate</p>
                                    <p id="card-savings-rate" class="text-2xl font-bold text-bloom-purple">0%</p>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Goals Progress -->
                    <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-8">
                        <div class="bg-white rounded-lg shadow p-6">
                            <h2 class="text-lg font-semibold mb-4 text-bloom-purple">My Goals Progress</h2>
                            <div class="space-y-4">
                                <div class="goal-card">
                                    <div class="flex justify-between items-center mb-2">
                                        <span class="font-semibold">Emergency Fund</span>
                                        <span class="text-sm">â‚¹3,200 / â‚¹5,000</span>
                                    </div>
                                    <div class="progress-bar">
                                        <div class="progress-fill" style="width: 64%"></div>
                                    </div>
                                </div>
                                
                                <div class="goal-card">
                                    <div class="flex justify-between items-center mb-2">
                                        <span class="font-semibold">Travel Fund</span>
                                        <span class="text-sm">â‚¹850 / â‚¹2,000</span>
                                    </div>
                                    <div class="progress-bar">
                                        <div class="progress-fill" style="width: 42%"></div>
                                    </div>
                                </div>
                                
                                <div class="goal-card">
                                    <div class="flex justify-between items-center mb-2">
                                        <span class="font-semibold">Education</span>
                                        <span class="text-sm">â‚¹1,200 / â‚¹3,000</span>
                                    </div>
                                    <div class="progress-bar">
                                        <div class="progress-fill" style="width: 40%"></div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="bg-white rounded-lg shadow p-6">
                            <h2 class="text-lg font-semibold mb-4 text-bloom-purple">Recent Transactions</h2>
                            <div class="space-y-3">
                                <div class="transaction-item flex justify-between items-center p-3 border-b">
                                    <div class="flex items-center">
                                        <div class="w-10 h-10 bg-pink-100 rounded-full flex items-center justify-center mr-3">
                                            <i class="fas fa-utensils text-bloom-pink"></i>
                                        </div>
                                        <div>
                                            <p class="font-medium">Brunch with Friends</p>
                                            <p class="text-sm text-gray-600">Cafe</p>
                                        </div>
                                    </div>
                                    <div class="text-right">
                                        <p class="font-medium text-red-600">-â‚¹45.50</p>
                                        <p class="text-sm text-gray-600">Yesterday</p>
                                    </div>
                                </div>
                                
                                <div class="transaction-item flex justify-between items-center p-3 border-b">
                                    <div class="flex items-center">
                                        <div class="w-10 h-10 bg-green-100 rounded-full flex items-center justify-center mr-3">
                                            <i class="fas fa-money-bill-wave text-green-600"></i>
                                        </div>
                                        <div>
                                            <p class="font-medium">Freelance Project</p>
                                            <p class="text-sm text-gray-600">Income</p>
                                        </div>
                                    </div>
                                    <div class="text-right">
                                        <p class="font-medium text-green-600">+â‚¹1,200.00</p>
                                        <p class="text-sm text-gray-600">2 days ago</p>
                                    </div>
                                </div>
                                
                                <div class="transaction-item flex justify-between items-center p-3 border-b">
                                    <div class="flex items-center">
                                        <div class="w-10 h-10 bg-blue-100 rounded-full flex items-center justify-center mr-3">
                                            <i class="fas fa-book text-blue-600"></i>
                                        </div>
                                        <div>
                                            <p class="font-medium">Online Course</p>
                                            <p class="text-sm text-gray-600">Education</p>
                                        </div>
                                    </div>
                                    <div class="text-right">
                                        <p class="font-medium text-red-600">-â‚¹89.99</p>
                                        <p class="text-sm text-gray-600">4 days ago</p>
                                    </div>
                                </div>
                            </div>
                            <button class="w-full mt-4 text-bloom-pink hover:text-bloom-purple text-sm font-medium">
                                View All Transactions â†’
                            </button>
                        </div>
                    </div>

                    <!-- Financial Tips -->
                    <div class="bg-white rounded-lg shadow p-6">
                        <h2 class="text-lg font-semibold mb-4 text-bloom-purple">ðŸ’¡ Today's Financial Tip</h2>
                        <p class="text-gray-700 mb-4">
                            "Start building your emergency fund today! Aim for 3-6 months of living expenses. 
                            Even small, regular contributions add up over time. You've got this! ðŸ’ª"
                        </p>
                        <div class="flex items-center text-sm text-gray-600">
                            <i class="fas fa-heart text-bloom-pink mr-2"></i>
                            <span>Personalized for your journey</span>
                        </div>
                    </div>
                </div>

                <!-- Other Pages -->
                <div id="budget-page" class="page-content hidden">
                    <div class="mb-8">
                        <h1 class="text-2xl font-bold text-gray-900">My Budget</h1>
                        <p class="text-gray-600">Plan your spending, track your budget, and manage your investments and savings.</p>
                    </div>
                    <div class="bg-white rounded-lg shadow p-6 mb-6">
                        <h2 class="text-lg font-semibold mb-4 text-bloom-purple">Add Income / Expense / Investment / Savings</h2>
                        <form id="budget-form" class="grid grid-cols-1 md:grid-cols-7 gap-4 mb-4" onsubmit="addBudgetItem(event)">
                            <select id="budget-type" class="border rounded-md px-3 py-2" required>
                                <option value="">Type</option>
                                <option value="income">Income</option>
                                <option value="expense">Expense</option>
                                <option value="investment">Investment</option>
                                <option value="savings">Savings</option>
                            </select>
                            <input id="budget-desc" type="text" class="border rounded-md px-3 py-2" placeholder="Description" required>
                            <input id="budget-amount" type="number" min="0" step="0.01" class="border rounded-md px-3 py-2" placeholder="Amount" required>
                            <select id="budget-month" class="border rounded-md px-3 py-2">
                                <option value="">Month</option>
                                <option value="January">January</option>
                                <option value="February">February</option>
                                <option value="March">March</option>
                                <option value="April">April</option>
                                <option value="May">May</option>
                                <option value="June">June</option>
                                <option value="July">July</option>
                                <option value="August">August</option>
                                <option value="September">September</option>
                                <option value="October">October</option>
                                <option value="November">November</option>
                                <option value="December">December</option>
                            </select>
                            <input id="budget-year" type="number" min="2000" max="2100" class="border rounded-md px-3 py-2" placeholder="Year">
                            <input id="budget-date" type="date" class="border rounded-md px-3 py-2" required>
                            <button type="submit" class="gradient-bg text-white rounded-md px-4 py-2 hover:opacity-90">Add</button>
                        </form>
                        <div>
                            <h3 class="font-semibold mb-2 text-bloom-purple">Budget Items</h3>
                            <table class="w-full text-sm mb-4">
                                <thead>
                                    <tr class="bg-bloom-lavender">
                                        <th class="py-2 px-2 text-left">Type</th>
                                        <th class="py-2 px-2 text-left">Description</th>
                                        <th class="py-2 px-2 text-right">Amount</th>
                                        <th class="py-2 px-2 text-left">Month</th>
                                        <th class="py-2 px-2 text-left">Year</th>
                                        <th class="py-2 px-2 text-left">Date Updated</th>
                                        <th class="py-2 px-2"></th>
                                    </tr>
                                </thead>
                                <tbody id="budget-list"></tbody>
                            </table>
                        </div>
                    </div>
                    <!-- Add this above the Summary and Emergency Fund section in your budget-page -->
                    <div class="mb-4 flex items-center gap-4">
                        <label for="summary-month-filter" class="font-semibold text-bloom-purple">Show Summary For:</label>
                        <select id="summary-month-filter" class="border rounded-md px-3 py-2" onchange="updateBudgetSummary()">
                            <option value="All">All Months</option>
                            <option value="January">January</option>
                            <option value="February">February</option>
                            <option value="March">March</option>
                            <option value="April">April</option>
                            <option value="May">May</option>
                            <option value="June">June</option>
                            <option value="July">July</option>
                            <option value="August">August</option>
                            <option value="September">September</option>
                            <option value="October">October</option>
                            <option value="November">November</option>
                            <option value="December">December</option>
                        </select>
                    </div>
                    <div class="mb-4 flex items-center gap-4">
                        <div class="relative group">
                            <button class="px-4 py-2 bg-bloom-purple text-white rounded hover:bg-bloom-pink text-sm">
                                Export Summary
                            </button>
                            <div class="absolute left-0 mt-2 w-48 bg-white rounded shadow-lg z-10 hidden group-hover:block">
                                <a href="#" onclick="exportSummary('csv')" class="block px-4 py-2 text-gray-700 hover:bg-bloom-lavender">CSV</a>
                                <a href="#" onclick="exportSummary('xlsx')" class="block px-4 py-2 text-gray-700 hover:bg-bloom-lavender">Excel (.xlsx)</a>
                                <a href="#" onclick="exportSummary('pdf')" class="block px-4 py-2 text-gray-700 hover:bg-bloom-lavender">PDF</a>
                                <a href="#" onclick="exportSummary('docx')" class="block px-4 py-2 text-gray-700 hover:bg-bloom-lavender">Word (.docx)</a>
                            </div>
                        </div>
                        <div class="relative group">
                            <button class="px-4 py-2 bg-bloom-pink text-white rounded hover:bg-bloom-purple text-sm">
                                Export Emergency/FD
                            </button>
                            <div class="absolute left-0 mt-2 w-56 bg-white rounded shadow-lg z-10 hidden group-hover:block">
                                <a href="#" onclick="exportEmergency('csv')" class="block px-4 py-2 text-gray-700 hover:bg-bloom-lavender">CSV</a>
                                <a href="#" onclick="exportEmergency('xlsx')" class="block px-4 py-2 text-gray-700 hover:bg-bloom-lavender">Excel (.xlsx)</a>
                                <a href="#" onclick="exportEmergency('pdf')" class="block px-4 py-2 text-gray-700 hover:bg-bloom-lavender">PDF</a>
                                <a href="#" onclick="exportEmergency('docx')" class="block px-4 py-2 text-gray-700 hover:bg-bloom-lavender">Word (.docx)</a>
                            </div>
                        </div>
                    </div>
                    <!-- Add this after the export buttons and before the Summary/Emergency Fund grid in your budget-page -->
                    <div class="bg-white rounded-lg shadow p-6 mb-6">
                        <h2 class="text-lg font-semibold mb-4 text-bloom-purple">Budget Visualization</h2>
                        <div class="mb-4 flex items-center gap-4">
                            <label for="viz-month" class="font-semibold text-bloom-purple">Select Month:</label>
                            <select id="viz-month" class="border rounded-md px-3 py-2" onchange="renderBudgetCharts()">
                                <option value="All">All Months</option>
                                <option value="January">January</option>
                                <option value="February">February</option>
                                <option value="March">March</option>
                                <option value="April">April</option>
                                <option value="May">May</option>
                                <option value="June">June</option>
                                <option value="July">July</option>
                                <option value="August">August</option>
                                <option value="September">September</option>
                                <option value="October">October</option>
                                <option value="November">November</option>
                                <option value="December">December</option>
                            </select>
                        </div>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                            <div>
                                <canvas id="budget-bar-chart"></canvas>
                            </div>
                            <div>
                                <canvas id="budget-pie-chart"></canvas>
                            </div>
                        </div>
                    </div>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div class="bg-white rounded-lg shadow p-6">
                            <h2 class="text-lg font-semibold mb-4 text-bloom-purple">Summary</h2>
                            <ul class="mb-4">
                                <li>ðŸ’° <b>Total Income:</b> â‚¹<span id="total-income">0.00</span></li>
                                <li>ðŸ’¸ <b>Total Expenses:</b> â‚¹<span id="total-expense">0.00</span></li>
                                <li>ðŸ“ˆ <b>Total Investments:</b> â‚¹<span id="total-investment">0.00</span></li>
                                <li>ðŸŒ± <b>Total Savings:</b> â‚¹<span id="total-savings">0.00</span></li>
                                <li>ðŸ§® <b>Balance:</b> â‚¹<span id="balance-amount">0.00</span></li>
                            </ul>
                        </div>
                        <div class="bg-white rounded-lg shadow p-6">
                            <h2 class="text-lg font-semibold mb-4 text-bloom-purple">Emergency Fund & FD Setup</h2>
                            <p class="mb-2">Recommended Emergency Fund: <b>3-6 months</b> of expenses.</p>
                            <p class="mb-2">Your Emergency Fund Target: â‚¹<span id="emergency-target">0.00</span></p>
                            <p class="mb-2">Available for Emergency Fund: â‚¹<span id="emergency-available">0.00</span></p>
                            <p class="mb-2">Available for FD: â‚¹<span id="fd-available">0.00</span></p>
                        </div>
                    </div>
                </div>

                <div id="goals-page" class="page-content hidden">
                    <div class="mb-8">
                        <h1 class="text-2xl font-bold text-gray-900">Savings Goals</h1>
                        <p class="text-gray-600">Dream big and save smart for your future.</p>
                    </div>
                    <div class="bg-white rounded-lg shadow p-6 mb-6">
                        <h2 class="text-lg font-semibold mb-4 text-bloom-purple">Add Savings Goal</h2>
                        <form id="goal-form" class="grid grid-cols-1 md:grid-cols-7 gap-4 mb-4" onsubmit="addGoalItem(event)">
                            <select id="goal-type" class="border rounded-md px-3 py-2" required onchange="updateGoalDescription()">
                                <option value="">Type of Goal</option>
                                <option value="future-fund">Fund For Future Use</option>
                                <option value="debt-reduction">Reduce high-interest debt / Debt / Credit Card Balances</option>
                                <option value="major-life">Major Life Events / Long Term Goals</option>
                                <option value="short-term">Short Term Goals</option>
                            </select>
                            <input type="text" id="goal-desc" class="border rounded-md px-3 py-2" placeholder="Description" required>
                            <input id="goal-amount" type="number" min="0" step="0.01" class="border rounded-md px-3 py-2" placeholder="Amount" required>
                            <input id="goal-monthly" type="number" min="0" step="0.01" class="border rounded-md px-3 py-2" placeholder="Monthly Goal">
                            <select id="goal-month" class="border rounded-md px-3 py-2">
                                <option value="">Month</option>
                                <option value="January">January</option>
                                <option value="February">February</option>
                                <option value="March">March</option>
                                <option value="April">April</option>
                                <option value="May">May</option>
                                <option value="June">June</option>
                                <option value="July">July</option>
                                <option value="August">August</option>
                                <option value="September">September</option>
                                <option value="October">October</option>
                                <option value="November">November</option>
                                <option value="December">December</option>
                            </select>
                            <input id="goal-year" type="number" min="2000" max="2100" class="border rounded-md px-3 py-2" placeholder="Year">
                            <input id="goal-date" type="date" class="border rounded-md px-3 py-2" required>
                            <button type="submit" class="gradient-bg text-white rounded-md px-4 py-2 hover:opacity-90">Add</button>
                        </form>
                        <div>
                            <h3 class="font-semibold mb-2 text-bloom-purple">Goals List</h3>
                            <table class="w-full text-sm mb-4">
                                <thead>
                                    <tr class="bg-bloom-lavender">
                                        <th class="py-2 px-2 text-left">Type</th>
                                        <th class="py-2 px-2 text-left">Description</th>
                                        <th class="py-2 px-2 text-right">Amount</th>
                                        <th class="py-2 px-2 text-right">Monthly Goal</th>
                                        <th class="py-2 px-2 text-right">Balance</th>
                                        <th class="py-2 px-2 text-left">Month</th>
                                        <th class="py-2 px-2 text-left">Year</th>
                                        <th class="py-2 px-2 text-left">Date Updated</th>
                                        <th class="py-2 px-2 text-right">Available Balance</th>
                                        <th class="py-2 px-2 text-right"></th>
                                    </tr>
                                </thead>
                                <tbody id="goals-list"></tbody>
                            </table>
                        </div>
                    </div>
                    <div class="bg-white rounded-lg shadow p-6 mb-6">
                        <h2 class="text-lg font-semibold mb-4 text-bloom-purple">Goal Visualization</h2>
                        <div class="mb-4 flex items-center gap-4">
                            <label for="goal-viz-month" class="font-semibold text-bloom-purple">Select Month:</label>
                            <select id="goal-viz-month" class="border rounded-md px-3 py-2" onchange="renderGoalCharts()">
                                <option value="All">All Months</option>
                                <option value="January">January</option>
                                <option value="February">February</option>
                                <option value="March">March</option>
                                <option value="April">April</option>
                                <option value="May">May</option>
                                <option value="June">June</option>
                                <option value="July">July</option>
                                <option value="August">August</option>
                                <option value="September">September</option>
                                <option value="October">October</option>
                                <option value="November">November</option>
                                <option value="December">December</option>
                            </select>
                        </div>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                            <div>
                                <canvas id="goal-bar-chart"></canvas>
                            </div>
                            <div>
                                <canvas id="goal-pie-chart"></canvas>
                            </div>
                        </div>
                    </div>

                    <div class="mb-4 flex items-center gap-4">
                        <div class="relative group">
                            <button class="px-4 py-2 bg-bloom-purple text-white rounded hover:bg-bloom-pink text-sm">
                                Export Goal Summary
                            </button>
                            <div class="absolute left-0 mt-2 w-48 bg-white rounded shadow-lg z-10 hidden group-hover:block">
                                <a href="#" onclick="exportGoalSummary('csv')" class="block px-4 py-2 text-gray-700 hover:bg-bloom-lavender">CSV</a>
                                <a href="#" onclick="exportGoalSummary('xlsx')" class="block px-4 py-2 text-gray-700 hover:bg-bloom-lavender">Excel (.xlsx)</a>
                                <a href="#" onclick="exportGoalSummary('pdf')" class="block px-4 py-2 text-gray-700 hover:bg-bloom-lavender">PDF</a>
                                <a href="#" onclick="exportGoalSummary('docx')" class="block px-4 py-2 text-gray-700 hover:bg-bloom-lavender">Word (.docx)</a>
                            </div>
                        </div>
                    </div>

                    <div class="bg-white rounded-lg shadow p-6 mb-6">
                        <h2 class="text-lg font-semibold mb-4 text-bloom-purple">Goal Summary</h2>

                        <div class="mb-4 flex items-center gap-4">
                            <label for="goal-summary-month" class="font-semibold text-bloom-purple">Show Summary For:</label>
                            <select id="goal-summary-month" class="border rounded-md px-3 py-2">
                                <option value="All">All Months</option>
                                <option value="January">January</option>
                                <option value="February">February</option>
                                <option value="March">March</option>
                                <option value="April">April</option>
                                <option value="May">May</option>
                                <option value="June">June</option>
                                <option value="July">July</option>
                                <option value="August">August</option>
                                <option value="September">September</option>
                                <option value="October">October</option>
                                <option value="November">November</option>
                                <option value="December">December</option>
                            </select>
                        </div>

                        <ul class="mb-4">
                            <li>ðŸ’° <b>Total Goal Amount:</b> â‚¹<span id="total-goal-amount">0.00</span></li>
                            <li>ðŸ“… <b>Total Monthly Contributions:</b> â‚¹<span id="total-monthly-goal">0.00</span></li>
                        </ul>
                    </div>
                </div>

                <div id="transactions-page" class="page-content hidden">
                    <!-- Transactions content -->
                </div>

                <div id="education-page" class="page-content hidden">
                    <div class="mb-8">
                        <h1 class="text-2xl font-bold text-gray-900">Learn & Grow</h1>
                        <p class="text-gray-600">Expand your financial knowledge and skills.</p>
                    </div>
                    <div class="bg-white rounded-lg shadow p-6">
                        <h2 class="text-lg font-semibold mb-4 text-bloom-purple">Financial Education</h2>
                        <p class="text-gray-600">Educational content coming soon!</p>
                    </div>
                </div>

                <div id="community-page" class="page-content hidden">
                    <div class="mb-8">
                        <h1 class="text-2xl font-bold text-gray-900">Community</h1>
                        <p class="text-gray-600">Connect with other amazing women on their financial journeys.</p>
                    </div>
                    <div class="bg-white rounded-lg shadow p-6">
                        <h2 class="text-lg font-semibold mb-4 text-bloom-purple">Women's Financial Community</h2>
                        <p class="text-gray-600">Community features coming soon!</p>
                    </div>
                </div>

                <div id="profile-page" class="page-content hidden">
                    <!-- Profile content -->
                </div>

                <div id="settings-page" class="page-content hidden">
                    <!--
                </div>
            </main>
        </div>
    </div>

    <!-- Modal for notifications -->
    <div id="notification-modal" class="hidden fixed inset-0 bg-gray-600 bg-opacity-50 flex items-center justify-center z-50">
        <div class="bg-white rounded-lg p-6 max-w-sm mx-auto">
            <div class="text-center mb-4">
                <i class="fas fa-heart text-bloom-pink text-3xl"></i>
            </div>
            <h3 class="text-lg font-semibold mb-4 text-center" id="modal-title">Notification</h3>
            <p class="text-gray-600 mb-4 text-center" id="modal-message">This is a notification message.</p>
            <button onclick="closeModal()" class="w-full gradient-bg text-white py-2 px-4 rounded-md hover:opacity-90">
                Got it!
            </button>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/docx/8.0.3/docx.umd.min.js"></script>
    <script>
/* Consolidated app script:
   - session/auth/navigation
   - budget module (add/edit/remove, persistence, charts, summary)
   - goals module (add/edit/remove, monthly field, persistence, charts, summary)
   - no implicit syncing from budget -> goals
*/

(function(){

  // --- small helpers ---
  function qs(id){ return document.getElementById(id); }
  function escapeHtml(s){ if (s===undefined||s===null) return ''; return String(s).replace(/[&<>"']/g, c=>({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[c])); }
  function safe(fn){ try{ fn(); }catch(e){ console.error(e); } }

  // --- Loading overlay + bootstrap ---
  function hideLoading(){ const el = qs('loading'); if (el) el.style.display = 'none'; }

  // --- App state and session ---
  const appState = { currentUser:null, isAuthenticated:false, currentPage:'login' };

  function saveSession(){
    if (appState.currentUser) localStorage.setItem('bloomUser', JSON.stringify(appState.currentUser));
    localStorage.setItem('bloomIsAuthenticated', appState.isAuthenticated ? 'true' : 'false');
    localStorage.setItem('bloomLastPage', appState.currentPage || 'login');
  }
  function restoreSession(){
    // Restore auth state, but don't perform navigation here.
    // Returns the last page name (or null) so caller can decide navigation.
    const user = localStorage.getItem('bloomUser');
    const auth = localStorage.getItem('bloomIsAuthenticated');
    const last = localStorage.getItem('bloomLastPage');
    if (user && auth === 'true') {
      try { appState.currentUser = JSON.parse(user); } catch(e){ appState.currentUser = { name: '', email: '' }; }
      appState.isAuthenticated = true;
    } else {
      appState.currentUser = null;
      appState.isAuthenticated = false;
    }
    // populate sidebar/header UI if DOM elements exist
    try { if (appState.currentUser) { const name = appState.currentUser.name || appState.currentUser.email?.split('@')[0] || 'User'; if (qs('user-initials')) qs('user-initials').textContent = name.charAt(0).toUpperCase(); if (qs('user-name')) qs('user-name').textContent = name; } else { if (qs('user-initials')) qs('user-initials').textContent = 'U'; if (qs('user-name')) qs('user-name').textContent = 'User'; } } catch(e){}
    return last || null;
  }

  // --- Navigation / Pages ---
  function hideAllPages(){
    document.querySelectorAll('.page').forEach(p=>p.classList.remove('active-page'));
  }
  function showLogin(){ hideAllPages(); qs('login-page').classList.add('active-page'); appState.currentPage='login'; saveSession(); }
  function showRegister(){ hideAllPages(); qs('register-page').classList.add('active-page'); appState.currentPage='register'; saveSession(); }
  function showApp(){ hideAllPages(); qs('app-page').classList.add('active-page'); navigateTo('dashboard'); appState.currentPage='app'; saveSession(); }
  function navigateTo(page){
    document.querySelectorAll('.page-content').forEach(c=>c.classList.add('hidden'));
    const target = qs(`${page}-page`);
    if (target) target.classList.remove('hidden');
    document.querySelectorAll('.nav-item').forEach(n=>n.classList.remove('active'));
    const navBtn = Array.from(document.querySelectorAll('.nav-item')).find(el => el.getAttribute('onclick') && el.getAttribute('onclick').includes(`navigateTo('${page}')`));
    if (navBtn) navBtn.classList.add('active');
    appState.currentPage = page;
    saveSession();
    // refresh dashboard when navigating there
    if (page === 'dashboard') updateDashboardSummary();
  }

  // --- Auth handlers ---
  function handleLogin(ev){
    ev && ev.preventDefault();
    const email = qs('email').value.trim();
    const password = qs('password').value;
    if (!email || !password){ showNotification('Error','Please fill all fields'); return; }
    appState.currentUser = { email, name: email.split('@')[0] || 'User' };
    appState.isAuthenticated = true;
    qs('user-initials').textContent = appState.currentUser.name.charAt(0).toUpperCase();
    qs('user-name').textContent = appState.currentUser.name;
    saveSession();
    showApp();
    showNotification('Welcome','Signed in');
  }
  function handleRegister(ev){
    ev && ev.preventDefault();
    const name = qs('register-name').value.trim();
    const email = qs('register-email').value.trim();
    const pw = qs('register-password').value;
    const confirm = qs('register-confirm').value;
    if (!name || !email || !pw || !confirm){ showNotification('Error','Fill all fields'); return; }
    if (pw.length < 8){ showNotification('Error','Password min 8 chars'); return; }
    if (pw !== confirm){ showNotification('Error','Passwords do not match'); return; }
    appState.currentUser = { name, email };
    appState.isAuthenticated = true;
    qs('user-initials').textContent = name.charAt(0).toUpperCase();
    qs('user-name').textContent = name;
    saveSession();
    showApp();
    showNotification('Welcome','Account created');
  }
  function handleLogout(){
    appState.currentUser = null; appState.isAuthenticated = false;
    localStorage.removeItem('bloomUser'); localStorage.removeItem('bloomIsAuthenticated'); localStorage.removeItem('bloomLastPage');
    showLogin(); showNotification('Signed out','You are logged out');
  }

  // --- UI helpers ---
  function toggleSidebar(){ qs('sidebar').classList.toggle('mobile-open'); }
  function toggleUserMenu(){
    const menu = qs('user-menu');
    const btn = qs('header-user-btn');
    if (!menu || !btn) return;
    menu.classList.toggle('hidden');
    const expanded = !menu.classList.contains('hidden');
    btn.setAttribute('aria-expanded', String(expanded));
    if (expanded) {
      // populate displayed name/email
      const name = appState.currentUser?.name || appState.currentUser?.email?.split('@')[0] || 'User';
      if (qs('menu-user-name')) qs('menu-user-name').textContent = name;
      if (qs('menu-user-email')) qs('menu-user-email').textContent = appState.currentUser?.email || '';
    }
  }

  function closeUserMenu(){
    const menu = qs('user-menu');
    const btn = qs('header-user-btn');
    if (!menu || !btn) return;
    if (!menu.classList.contains('hidden')) menu.classList.add('hidden');
    btn.setAttribute('aria-expanded','false');
  }

  // close both header and sidebar menus on outside click
  document.addEventListener('click', function(e){
    // header menu
    const headerBtn = qs('header-user-btn'), headerMenu = qs('user-menu');
    if (headerMenu && headerBtn && !headerMenu.classList.contains('hidden') && !headerMenu.contains(e.target) && !headerBtn.contains(e.target)) {
      closeUserMenu();
    }
    // sidebar menu (existing function closeSidebarUserMenu handles hiding)
    const sbMenu = qs('sidebar-user-menu'), sbBtn = qs('sidebar-user-btn');
    if (sbMenu && sbBtn && !sbMenu.classList.contains('hidden') && !sbMenu.contains(e.target) && !sbBtn.contains(e.target)) {
      closeSidebarUserMenu();
    }
  });

  // Sidebar helpers (fix: populate/close functions required by other code)
  function populateSidebarUser() {
    const name = appState.currentUser?.name || appState.currentUser?.email?.split('@')[0] || 'User';
    if (qs('sidebar-user-name')) qs('sidebar-user-name').textContent = name;
    if (qs('sidebar-user-email')) qs('sidebar-user-email').textContent = appState.currentUser?.email || '';
    if (qs('user-name')) qs('user-name').textContent = name;
    if (qs('user-initials') && name) qs('user-initials').textContent = name.charAt(0).toUpperCase();
    if (qs('menu-user-name')) qs('menu-user-name').textContent = name;
    if (qs('menu-user-email')) qs('menu-user-email').textContent = appState.currentUser?.email || '';
  }

  function closeSidebarUserMenu() {
    const menu = qs('sidebar-user-menu');
    const btn = qs('sidebar-user-btn');
    if (menu && !menu.classList.contains('hidden')) menu.classList.add('hidden');
    if (btn) btn.setAttribute('aria-expanded','false');
  }

  // attach header button listener on DOM ready (safe duplicate protection)
  document.addEventListener('DOMContentLoaded', function(){
    const headerBtn = qs('header-user-btn');
    if (headerBtn) {
      headerBtn.removeEventListener('click', toggleUserMenu);
      headerBtn.addEventListener('click', function(e){ e.stopPropagation(); toggleUserMenu(); });
    }
  });

  // ensure user info is populated after login/register/restore
  const _origHandleLogin = handleLogin;
  handleLogin = function(ev){ _origHandleLogin(ev); populateSidebarUser(); };
  const _origHandleRegister = handleRegister;
  handleRegister = function(ev){ _origHandleRegister(ev); populateSidebarUser(); };
  const _origRestoreSession = restoreSession;
  restoreSession = function(){ _origRestoreSession(); populateSidebarUser(); };
  
  // --- Dashboard sync ---
  function updateDashboardSummary(){
    // use month filter if present
    const selected = qs('summary-month-filter')?.value || 'All';
    const budget = Array.isArray(window.budgetItems) ? window.budgetItems.slice() : [];
    const goals = Array.isArray(window.goalsItems) ? window.goalsItems.slice() : [];
    let budgetFiltered = budget;
    if (selected !== 'All') budgetFiltered = budget.filter(b => b.month === selected);

    let income = 0, expense = 0, savings = 0, investment = 0;
    budgetFiltered.forEach(it => {
      if (it.type === 'income') income += Number(it.amount || 0);
      if (it.type === 'expense') expense += Number(it.amount || 0);
      if (it.type === 'savings') savings += Number(it.amount || 0);
      if (it.type === 'investment') investment += Number(it.amount || 0);
    });

    // include monthly contributions from goals as part of "savings" pool
    const goalMonthly = goals.reduce((s,g) => s + Number(g.monthly || 0), 0);
    const totalSavings = savings + investment + goalMonthly;

    // compute savings rate (savings / income) safe
    const savingsRate = income > 0 ? Math.round((totalSavings / income) * 100) : 0;

    if (qs('card-total-savings')) qs('card-total-savings').textContent = 'â‚¹' + Number(totalSavings).toFixed(2);
    if (qs('card-monthly-income')) qs('card-monthly-income').textContent = 'â‚¹' + Number(income).toFixed(2);
    if (qs('card-monthly-expense')) qs('card-monthly-expense').textContent = 'â‚¹' + Number(expense).toFixed(2);
    if (qs('card-savings-rate')) qs('card-savings-rate').textContent = savingsRate + '%';
  }
  // expose to modules
  window.updateDashboardSummary = updateDashboardSummary;

  // Attach auth/form handlers that exist on page
  document.addEventListener('DOMContentLoaded', function(){
    // hide loading and restore session after small delay (keep as before)
    setTimeout(function(){
      hideLoading();
      const last = restoreSession();
      populateSidebarUser();
      if (appState.isAuthenticated) {
        // show app and navigate to last saved page (if valid)
        showApp();
        if (last && last !== 'login' && last !== 'register') navigateTo(last);
      } else {
        showLogin();
      }
    }, 600);
 
    // login/register form handlers
    safe(()=>{ const f = document.querySelector('#login-page form'); if (f){ f.addEventListener('submit', handleLogin); } });
    safe(()=>{ const f = document.querySelector('#register-page form'); if (f){ f.addEventListener('submit', handleRegister); } });
 
    // header controls
    safe(()=>{ const sb = document.querySelector('button[onclick="toggleSidebar()"]'); if (sb) sb.addEventListener('click', toggleSidebar); });
    safe(()=>{ const um = document.querySelector('button[onclick="toggleUserMenu()"]'); if (um) um.addEventListener('click', toggleUserMenu); });
 
  });

  // --- Budget module (self-contained) ---
  (function BudgetModule(){
    window.budgetItems = window.budgetItems || [];
    let editIndex = null;
    let barChart = null, pieChart = null;

    function load(){ try{ const raw = localStorage.getItem('budgetItems'); window.budgetItems = raw ? JSON.parse(raw) : []; }catch(e){ window.budgetItems = []; } }
    function save(){ localStorage.setItem('budgetItems', JSON.stringify(window.budgetItems)); }

    function renderList(){
      const tbody = qs('budget-list'); if (!tbody) return; tbody.innerHTML = '';
      window.budgetItems.forEach((it,i)=>{
        const tr = document.createElement('tr');
        tr.innerHTML = `
          <td class="py-1 px-2 capitalize">${escapeHtml(it.type)}</td>
          <td class="py-1 px-2">${escapeHtml(it.desc)}</td>
          <td class="py-1 px-2 text-right">â‚¹${Number(it.amount).toFixed(2)}</td>
          <td class="py-1 px-2">${escapeHtml(it.month||'')}</td>
          <td class="py-1 px-2">${escapeHtml(it.year||'')}</td>
          <td class="py-1 px-2">${escapeHtml(it.date||'')}</td>
          <td class="py-1 px-2 text-right">
            <button type="button" onclick="window.Budget_edit(${i})" class="text-bloom-purple hover:underline mr-2">Edit</button>
            <button type="button" onclick="window.Budget_remove(${i})" class="text-bloom-coral hover:underline">Remove</button>
          </td>`;
        tbody.appendChild(tr);
      });
    }

    function addOrUpdate(ev){
      ev && ev.preventDefault();
      const type = qs('budget-type')?.value || '';
      const desc = qs('budget-desc')?.value || '';
      const amount = parseFloat(qs('budget-amount')?.value || 0);
      const date = qs('budget-date')?.value || '';
      const month = qs('budget-month')?.value || '';
      const year = qs('budget-year')?.value || '';
      if (!type || !desc || isNaN(amount) || amount<=0 || !date){ alert('Please fill valid budget fields'); return; }
      const item = { type, desc, amount, month, year, date };
      if (editIndex !== null){ window.budgetItems[editIndex] = item; editIndex = null; setButton('budget-form','Add'); }
      else window.budgetItems.push(item);
      save(); resetForm(); renderList(); updateSummary(); renderCharts();
      if (typeof window.updateDashboardSummary === 'function') window.updateDashboardSummary();
      // refresh goals' available balances after budget change
      if (typeof window.updateGoalsAvailableBalances === 'function') window.updateGoalsAvailableBalances();
    }

    function edit(i){
      const it = window.budgetItems[i]; if (!it) return;
      qs('budget-type').value = it.type; qs('budget-desc').value = it.desc; qs('budget-amount').value = it.amount;
      qs('budget-month').value = it.month||''; qs('budget-year').value = it.year||''; qs('budget-date').value = it.date||'';
      editIndex = i; setButton('budget-form','Update');
    }
    function remove(i){
      if (!confirm('Remove this budget item?')) return;
      window.budgetItems.splice(i,1); save(); renderList(); updateSummary(); renderCharts();
      if (typeof window.updateDashboardSummary === 'function') window.updateDashboardSummary();
      // refresh goals' available balances after budget change
      if (typeof window.updateGoalsAvailableBalances === 'function') window.updateGoalsAvailableBalances();
      if (editIndex===i){ resetForm(); editIndex=null; setButton('budget-form','Add'); }
    }

    function resetForm(){ const f = qs('budget-form'); if (f) f.reset(); }
    function setButton(formId,text){ const b = document.querySelector(`#${formId} button[type="submit"]`); if (b) b.textContent = text; }

    function updateSummary(){
      const selected = qs('summary-month-filter')?.value || 'All';
      let items = window.budgetItems || [];
      if (selected!=='All') items = items.filter(x=>x.month===selected);
      let income=0, expense=0, investment=0, savings=0;
      items.forEach(it=>{ if (it.type==='income') income+=it.amount; if (it.type==='expense') expense+=it.amount; if (it.type==='investment') investment+=it.amount; if (it.type==='savings') savings+=it.amount; });
      const balance = income - expense - investment - savings;
      if (qs('total-income')) qs('total-income').textContent = income.toFixed(2);
      if (qs('total-expense')) qs('total-expense').textContent = expense.toFixed(2);
      if (qs('total-investment')) qs('total-investment').textContent = investment.toFixed(2);
      if (qs('total-savings')) qs('total-savings').textContent = savings.toFixed(2);
      if (qs('balance-amount')) qs('balance-amount').textContent = balance.toFixed(2);
      if (qs('emergency-target')) qs('emergency-target').textContent = (expense*3).toFixed(2);
      if (qs('emergency-available')) qs('emergency-available').textContent = (balance>0?balance.toFixed(2):'0.00');
      if (qs('fd-available')) qs('fd-available').textContent = (savings>0?savings.toFixed(2):'0.00');
    }

    function renderCharts(){
      if (typeof Chart !== 'function') return;
      const viz = qs('viz-month')?.value || 'All';
      const barEl = qs('budget-bar-chart'), pieEl = qs('budget-pie-chart');
      if (!barEl || !pieEl) return;
      // compute totals
      const months = ["January","February","March","April","May","June","July","August","September","October","November","December"];
      let inc=0, exp=0, inv=0, sav=0;
      let filtered = window.budgetItems;
      if (viz!=='All') filtered = filtered.filter(i=>i.month===viz);
      filtered.forEach(i=>{ if (i.type==='income') inc+=i.amount; if (i.type==='expense') exp+=i.amount; if (i.type==='investment') inv+=i.amount; if (i.type==='savings') sav+=i.amount; });
      try{ if (barChart) barChart.destroy(); if (pieChart) pieChart.destroy(); }catch(e){}
      barChart = new Chart(barEl.getContext('2d'), { type:'bar', data:{ labels:['Income','Expenses','Investments','Savings'], datasets:[{ label:`${viz} Totals`, data:[inc,exp,inv,sav], backgroundColor:['#a0e7e5','#ff85a2','#9c89b8','#ff6b6b'] }] }, options:{responsive:true} });
      pieChart = new Chart(pieEl.getContext('2d'), { type:'pie', data:{ labels:['Income','Expenses','Investments','Savings'], datasets:[{ data:[inc,exp,inv,sav], backgroundColor:['#a0e7e5','#ff85a2','#9c89b8','#ff6b6b'] }] }, options:{responsive:true} });
    }

    // compute available balance for a month (exposed for Goals)
    function getAvailableBalanceForMonth(month) {
      const items = Array.isArray(window.budgetItems) ? window.budgetItems.slice() : [];
      let filtered = items;
      if (month && month !== 'All') filtered = items.filter(i => i.month === month);
      let income = 0, expense = 0, investment = 0, savings = 0;
      filtered.forEach(it => {
        if (it.type === 'income') income += Number(it.amount || 0);
        if (it.type === 'expense') expense += Number(it.amount || 0);
        if (it.type === 'investment') investment += Number(it.amount || 0);
        if (it.type === 'savings') savings += Number(it.amount || 0);
      });
      return income - expense - investment - savings;
    }
    // expose
    window.getBudgetAvailableBalanceForMonth = getAvailableBalanceForMonth;
 
    // expose minimal functions for button onclick handlers
    window.Budget_edit = edit;
    window.Budget_remove = remove;
 
    // attach handlers on DOM ready
    document.addEventListener('DOMContentLoaded', function(){
      load(); renderList(); updateSummary(); renderCharts();
      // refresh dashboard after budget module initialized
      if (typeof window.updateDashboardSummary === 'function') window.updateDashboardSummary();
      const form = qs('budget-form'); if (form){ form.addEventListener('submit', addOrUpdate); }
      // ensure goals' available balances refresh after budget changes
      // call after budget form submit & remove (addOrUpdate/remove already call updateDashboardSummary)
      // We also call updateGoalsAvailableBalances where available
      const dateEl = qs('budget-date'); if (dateEl) dateEl.addEventListener('change', function(){ const d=new Date(this.value); if (!isNaN(d)){ const months=["January","February","March","April","May","June","July","August","September","October","November","December"]; if (qs('budget-month')) qs('budget-month').value = months[d.getMonth()]; if (qs('budget-year')) qs('budget-year').value = d.getFullYear(); } });
      const vizSel = qs('viz-month'); if (vizSel) vizSel.addEventListener('change', renderCharts);
      const summarySel = qs('summary-month-filter'); if (summarySel) summarySel.addEventListener('change', function(){ updateSummary(); renderCharts(); });
    });
 
  })();

  // --- Goals module (self-contained) ---
  (function GoalsModule(){
    window.goalsItems = window.goalsItems || (localStorage.getItem('goalsItems') ? JSON.parse(localStorage.getItem('goalsItems')) : []);
    let editIndex = null;
    window.goalBarChart = window.goalBarChart || null;
    window.goalPieChart = window.goalPieChart || null;

    function save(){ localStorage.setItem('goalsItems', JSON.stringify(window.goalsItems)); }
    function renderList(){
      const tbody = qs('goals-list'); if (!tbody) return; tbody.innerHTML = '';
      window.goalsItems.forEach((it,i)=>{
        const tr = document.createElement('tr');
        tr.innerHTML = `
          <td class="py-1 px-2 capitalize">${escapeHtml(getGoalTypeLabel(it.type))}</td>
          <td class="py-1 px-2">${escapeHtml(it.desc)}</td>
          <td class="py-1 px-2 text-right">â‚¹${Number(it.amount).toFixed(2)}</td>
          <td class="py-1 px-2 text-right">â‚¹${Number(it.monthly||0).toFixed(2)}</td>
          <td class="py-1 px-2 text-right">â‚¹${Number(it.balance || (Number(it.availableBalance||0) - Number(it.monthly||0))).toFixed(2)}</td>
          <td class="py-1 px-2">${escapeHtml(it.month||'')}</td>
          <td class="py-1 px-2">${escapeHtml(it.year||'')}</td>
          <td class="py-1 px-2">${escapeHtml(it.date||'')}</td>
          <td class="py-1 px-2 text-right">â‚¹${Number(it.availableBalance || 0).toFixed(2)}</td>
          <td class="py-1 px-2 text-right">
            <button type="button" onclick="window.Goal_edit(${i})" class="text-bloom-purple hover:underline mr-2">Edit</button>
            <button type="button" onclick="window.Goal_remove(${i})" class="text-bloom-coral hover:underline">Remove</button>
          </td>`;
        tbody.appendChild(tr);
      });
    }

    // compute and set availableBalance for each goal based on budget
    function updateGoalsAvailableBalances() {
      if (!Array.isArray(window.goalsItems)) return;
      window.goalsItems.forEach(g => {
        const month = g.month || 'All';
        let bal = 0;
        if (typeof window.getBudgetAvailableBalanceForMonth === 'function') {
          try { bal = Number(window.getBudgetAvailableBalanceForMonth(month)) || 0; } catch(e){ bal = 0; }
        } else if (Array.isArray(window.budgetItems)) {
          // fallback compute if helper not exposed
          const items = window.budgetItems.slice();
          let filtered = items;
          if (month && month !== 'All') filtered = items.filter(i => i.month === month);
          let income=0, expense=0, investment=0, savings=0;
          filtered.forEach(it => { if (it.type==='income') income+=Number(it.amount||0); if (it.type==='expense') expense+=Number(it.amount||0); if (it.type==='investment') investment+=Number(it.amount||0); if (it.type==='savings') savings+=Number(it.amount||0); });
          bal = income - expense - investment - savings;
        }
        g.availableBalance = bal;
        // compute Balance = Available Balance - Monthly Goal (automatic, not mandatory for user)
        g.balance = Number(g.availableBalance || 0) - Number(g.monthly || 0);
      });
      save(); // persist updated availableBalance & balance
      renderList();
    }
    // expose to other modules
    window.updateGoalsAvailableBalances = updateGoalsAvailableBalances;
 
    function addOrUpdate(ev){
      ev && ev.preventDefault();
      const type = qs('goal-type')?.value || '';
      const desc = qs('goal-desc')?.value || '';
      const amount = parseFloat(qs('goal-amount')?.value || 0);
      const monthly = parseFloat(qs('goal-monthly')?.value || 0);
      const date = qs('goal-date')?.value || '';
      const month = qs('goal-month')?.value || '';
      const year = qs('goal-year')?.value || '';
      if (!type || !desc || isNaN(amount) || amount<=0 || !date){ alert('Please fill valid goal fields'); return; }
      const item = { type, desc, amount, monthly, month, year, date };
      if (editIndex !== null){ window.goalsItems[editIndex] = item; editIndex=null; setBtn('goal-form','Add'); } else { window.goalsItems.push(item); }
      save(); resetForm(); renderList(); renderCharts(); updateSummary();
      // update available balances immediately after goal change
      updateGoalsAvailableBalances();
    }

    function edit(i){
      const it = window.goalsItems[i]; if (!it) return;
      qs('goal-type').value = it.type||''; qs('goal-desc').value = it.desc||''; qs('goal-amount').value = it.amount||''; qs('goal-monthly').value = it.monthly||''; qs('goal-month').value = it.month||''; qs('goal-year').value = it.year||''; qs('goal-date').value = it.date||'';
      editIndex = i; setBtn('goal-form','Update');
    }
    function remove(i){
      if (!confirm('Remove this goal?')) return;
      window.goalsItems.splice(i,1); save(); renderList(); renderCharts(); updateSummary();
      if (typeof window.updateDashboardSummary === 'function') window.updateDashboardSummary();
      if (editIndex===i){ resetForm(); editIndex=null; setBtn('goal-form','Add'); }
    }

    function renderCharts(){
      if (typeof Chart !== 'function') return;
      const viz = qs('goal-viz-month')?.value || 'All';
      let filtered = window.goalsItems.slice();
      if (viz !== 'All') filtered = filtered.filter(g=>g.month===viz);
      const sums = { 'future-fund':0, 'debt-reduction':0, 'major-life':0, 'short-term':0 };
      filtered.forEach(g=> sums[g.type] = (sums[g.type]||0) + Number(g.amount||0));
      try{ if (window.goalBarChart) window.goalBarChart.destroy(); if (window.goalPieChart) window.goalPieChart.destroy(); }catch(e){}
      const barEl = qs('goal-bar-chart'), pieEl = qs('goal-pie-chart'); if (!barEl || !pieEl) return;
      window.goalBarChart = new Chart(barEl.getContext('2d'), { type:'bar', data:{ labels:['Future Fund','Debt Reduction','Major Life','Short Term'], datasets:[{ label:`${viz} Totals`, data:[sums['future-fund'],sums['debt-reduction'],sums['major-life'],sums['short-term']], backgroundColor:['#a0e7e5','#ff85a2','#9c89b8','#ff6b6b'] }] }, options:{responsive:true} });
      window.goalPieChart = new Chart(pieEl.getContext('2d'), { type:'pie', data:{ labels:['Future Fund','Debt Reduction','Major Life','Short Term'], datasets:[{ data:[sums['future-fund'],sums['debt-reduction'],sums['major-life'],sums['short-term']], backgroundColor:['#a0e7e5','#ff85a2','#9c89b8','#ff6b6b'] }] }, options:{responsive:true} });
    }

    function updateSummary(){
      const selected = qs('goal-summary-month')?.value || 'All';
      let items = window.goalsItems.slice();
      if (selected !== 'All') items = items.filter(g=>g.month===selected);
      const total = items.reduce((s,g)=>s + Number(g.amount||0), 0);
      const monthlyTotal = items.reduce((s,g)=>s + Number(g.monthly||0), 0);
      if (qs('total-goal-amount')) qs('total-goal-amount').textContent = Number(total).toFixed(2);
      if (qs('total-monthly-goal')) qs('total-monthly-goal').textContent = Number(monthlyTotal).toFixed(2);
    }

    function resetForm(){ const f=qs('goal-form'); if (f) f.reset(); setBtn('goal-form','Add'); }
    function setBtn(formId,text){ const b = document.querySelector(`#${formId} button[type="submit"]`); if (b) b.textContent = text; }
    function getGoalTypeLabel(type){ switch(type){ case 'future-fund':return 'Fund For Future Use'; case 'debt-reduction':return 'Reduce high-interest debt / Debt / Credit Card Balances'; case 'major-life':return 'Major Life Events / Long Term Goals'; case 'short-term':return 'Short Term Goals'; default: return type||''; } }

    window.Goal_edit = edit; window.Goal_remove = remove;

    document.addEventListener('DOMContentLoaded', function(){
      renderList(); renderCharts(); updateSummary();
      // refresh dashboard after goals module initialized
      if (typeof window.updateDashboardSummary === 'function') window.updateDashboardSummary();
      // compute available balances on load
      updateGoalsAvailableBalances();
      const form = qs('goal-form'); if (form) form.addEventListener('submit', addOrUpdate);
      const dateEl = qs('goal-date'); if (dateEl) dateEl.addEventListener('change', function(){ const d=new Date(this.value); if (!isNaN(d)){ const months=["January","February","March","April","May","June","July","August","September","October","November","December"]; if (qs('goal-month')) qs('goal-month').value = months[d.getMonth()]; if (qs('goal-year')) qs('goal-year').value = d.getFullYear(); } });
      const viz = qs('goal-viz-month'); if (viz) viz.addEventListener('change', function(){ renderCharts(); updateSummary(); });
      const summarySel = qs('goal-summary-month'); if (summarySel) summarySel.addEventListener('change', function(){ updateSummary(); renderCharts(); renderList(); });
    });

  })();

  // expose a few functions to global HTML attributes if needed
  window.toggleSidebar = toggleSidebar;
  window.toggleUserMenu = toggleUserMenu;
  window.handleLogout = handleLogout;
  window.showRegister = showRegister;
  window.showLogin = showLogin;
  // expose navigation and app-level functions used by inline onclick attributes
  window.navigateTo = navigateTo;
  window.showApp = showApp;

})();
</script>
</body>
</html>

